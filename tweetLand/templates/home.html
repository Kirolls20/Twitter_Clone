{% include "base.html" %}
{% load static %}

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adding Tweet</title>
    <link rel="stylesheet" href="{% static 'css/add_tweet.css' %}"> 
    <link rel="stylesheet" href="{% static 'css/add_comment.css' %}"> 
</head>

{% block content %}
<body><br>
    <h1 style="padding:10px; text-align: center;">Feeds..</h1>
<div style="display: flex; justify-content: flex-end; margin:40px;">
    <div class="width:100px;">
        <button class="btn btn-secondary" id="showPopup">Add Tweet</button>
        <!-- PopUP Contianer To Create A Tweet -->
        <div class="container">
            <div class="pop-up" id="popup">
                <h2 style="text-align: center;">Make A tweet!</h2>
                <form  method="post">
                    {% csrf_token %}
                    <div style="justify-content: center;">
                        {{form}}
                    </div>
                    <div class="btns-container">
                        <button type="submit" class="popup-btns">Tweet it</button>
                        <button id="closePopup" type="button" class="popup-btns">Cancel</button>
                    </div>    
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Looping thru all the tweets  -->
{% if  tweets %}
    {% for tweet in tweets %}
    <div class="card text-bg-dark mb-3" style="border:0; padding:none;max-width: 50rem; text-align: center; margin:auto;">
        <div class="card-header">
            <div class="container">
                <div class="row">
                    <div class="col-2">
                        {% if  tweet.user.profile_pic %}
                        <img src="{{tweet.user.profile_pic.url}}" alt="Profile pic" class="rounded-circle" width=50 height=50 >
                        {% else %}
                            <img src="{% static 'images/default_profile_pic.jpg' %}" alt="Profile pic" class="rounded-circle" width=50 height=50 >

                        {% endif %}
                    </div>
                    <div class="col-10" style="display: flex;">
                        <a href="{% url 'profile' tweet.user.id %}" style="color:rgb(58, 58, 240)"> by @{{tweet.user|lower}}</a>
                        <small class="text-muted">{{tweet.updated_at}}</small>
                        
                       
                        
                        
                    </div>
                </div>
            </div>   
        </div>
      <!-- Drop down options -->
       <div class="dropdown">
            <button class="btn btn-dark dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="float:right; border:0;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
                    <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                </svg>
            </button>
        <ul class="dropdown-menu">
            {% if tweet.user == request.user %}
                <!-- Edit Form --> 
                <li><a class="dropdown-item" href="{% url 'edit_tweet' tweet.id %}">Edit</a></li>
                <!-- Delete Form  -->
                <form  action="{%  url 'delete_tweet' tweet.id %}" method="post" onsubmit=" return  ConfirmSubmition()">
                    {% csrf_token %}
            
                    <button type="submit" class="dropdown-item">Delete</button>
                </form> 
            {% endif %}
                <li><a class="dropdown-item" href="#">Save for later</a></li>
        </ul>
        </div>
        <div class="card text-bg-dark mb-3" style="border-radius: 5px; border:#b3a8a8 8px; text-align: center;">
            <h5 class="text-muted" style="padding:4px;">{{tweet.tweet}}</h5>     
                <hr>
                <!-- Likes And Comment Section  -->
                <div class="container">
                    <div class="row">
                    </div>
                    <div class="col-5">
                        
                        {% if request.user in tweet.likes.all %}
                                <a href="{% url 'like_tweet' tweet.id %}"style="margin-left:20px;" >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/>
                                      </svg>
                                </a>
                            {% else %}
                                <a href="{% url 'like_tweet' tweet.id %}"style="margin-left:20px;" >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-heart" viewBox="0 0 16 16">
                                        <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"/>
                                    </svg>
                                </a>
                            {% endif %}
                            <small class="text-muted" style="margin-left:20px;"> {{tweet.total_likes}} Likes</small>
                    
                    </div>
                    <div class="col-7">
                        <a href="#tweet-{{ tweet.id }}" style="margin-left:20px;" class="show-comment-popup" data-tweetid="{{ tweet.id }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-chat-text" viewBox="0 0 16 16">
                                <path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"/>
                                <path d="M4 5.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zM4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8zm0 2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5z"/>
                              </svg>  
                        </a>
                        <!-- <button class="show-comment-popup" data-tweetid="{{ tweet.id }}">Open Popup</button> -->
                        <div class="container">
                            <div class="comment-popUpp">
                                <h5 style="justify-items: center; ">Comment Section</h5>
                                <form action="{% url 'tweet_comment' tweet.id %}" method="post">
                                    {% csrf_token %}
                                    <div style="justify-content: center;">
                                        {{form}}
                                    </div><br>
                                    <button type="submit" class="btn btn-info" name="comment">Send Comment</button>
                                </form>
                                <a href="#" id="comment-closePopup"   type="button" style="float:right;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
                                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                                      </svg>
                                </a>
                               
                            </div>
                        </div>
                        <a href="{% url 'comments_list'  tweet.id %}">
                            <small class="text-muted" style="margin-left:20px;">{{tweet.total_comments}} Comment</small>
                        </a>
                    </div>
                    </div>
                
                </div>
        </div> 
    </div>
    <!-- The Body Of the Tweet -->
</div><br>  

{% endfor %}
{% endif %}
{% endblock %}

<script>
    // Cretae Tweet
    document.getElementById('showPopup').addEventListener('click', function() {
    console.log('Clicked!')
    document.querySelector('.pop-up').style.display = 'flex';
    });
    document.getElementById('closePopup').addEventListener('click', function() {
    document.querySelector('.pop-up').style.display = 'none';
    });
    function ConfirmSubmition(){
        var onConfirm = confirm('Are You Sure you Want to Delete this Tweet?')
        return onConfirm;
    }
    // Comment Pop Up
    var buttons = document.querySelectorAll('.show-comment-popup');
    buttons.forEach(function(button) {
        button.addEventListener('click', function() {
        var tweetId = button.dataset.tweetid;
        console.log('Comment HERE for tweetId:', tweetId);
        document.querySelector('.comment-popUpp').style.display = 'flex';
  });
});

    document.getElementById('comment-closePopup').addEventListener('click',function(){
        console.log('Close Comment Section')
        document.querySelector('.comment-popUpp').style.display = 'none'
    })
</script>
</body>