{% include "base.html" %}
{% load static %}

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adding Tweet</title>
    <link rel="stylesheet" href="{% static 'css/add_tweet.css' %}"> 
</head>

{% block content %}
<body><br>
    <h1 style="padding:10px; text-align: center;">Feeds..</h1>
<div style="display: flex; justify-content: flex-end; margin:40px;">
    <div class="width:100px;">
        <button class="btn btn-secondary" id="showPopup">Add Tweet</button>
        <!-- PopUP Contianer -->
        <div class="container">
            <div class="pop-up" id="popup">
                <h2 style="text-align: center;">Make A tweet!</h2>
                <form  method="post">
                    {% csrf_token %}
                    <div style="justify-content: center;">
                        {{form}}
                    </div>
                    <div class="btns-container">
                        <button type="submit" class="popup-btns">Tweet it</button>
                        <button id="closePopup" type="button" class="popup-btns">Cancel</button>
                    </div>    
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Looping thru all the tweets  -->
{% if  tweets %}
    {% for tweet in tweets %}
    <div class="card text-bg-dark mb-3" style="border:0; padding:none;max-width: 50rem; text-align: center; margin:auto;">
        <div class="card-header">
            <div class="container">
                <div class="row">
                    <div class="col-2">
                        {% if  tweet.user.profile_pic %}
                        <img src="{{tweet.user.profile_pic.url}}" alt="Profile pic" class="rounded-circle" width=50 height=50 >
                        {% else %}
                            <img src="{% static 'images/default_profile_pic.jpg' %}" alt="Profile pic" class="rounded-circle" width=50 height=50 >

                        {% endif %}
                    </div>
                    <div class="col-10" style="display: flex;">
                        <a href="{% url 'profile' tweet.user.id %}" style="color:rgb(58, 58, 240)"> by @{{tweet.user|lower}}</a>
                        <small class="text-muted">{{tweet.updated_at}}</small>
                        <small class="text-muted" style="margin-left:20px;">{{tweet.total_likes}} Likes</small>
                        {% if request.user in tweet.likes.all %}
                            <a href="{% url 'like_tweet' tweet.id %}"style="margin-left:20px;" >
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/>
                                  </svg>
                            </a>
                        {% else %}
                            <a href="{% url 'like_tweet' tweet.id %}"style="margin-left:20px;" >
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-heart" viewBox="0 0 16 16">
                                    <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"/>
                                </svg>
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>   
        </div>
      <!-- Drop down options -->
       <div class="dropdown">
            <button class="btn btn-dark dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="float:right; border:0;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
                    <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                </svg>
            </button>
        <ul class="dropdown-menu">
            {% if tweet.user == request.user %}
                <!-- Edit Form --> 
                <li><a class="dropdown-item" href="{% url 'edit_tweet' tweet.id %}">Edit</a></li>
                <!-- Delete Form  -->
                <form  action="{%  url 'delete_tweet' tweet.id %}" method="post" onsubmit=" return  ConfirmSubmition()">
                    {% csrf_token %}
            
                    <button type="submit" class="dropdown-item">Delete</button>
                </form> 
            {% endif %}
                <li><a class="dropdown-item" href="#">Save for later</a></li>
        </ul>
        </div>
        <div class="card text-bg-dark mb-3" style="border-radius: 5px; border:#b3a8a8 8px; text-align: center;">
            <h5 class="text-muted" style="padding:4px;">{{tweet.tweet}}</h5>     
        
        </div> 
    </div>
    <!-- The Body Of the Tweet -->
</div><br>  

{% endfor %}
{% endif %}
{% endblock %}

<script>
    document.getElementById('showPopup').addEventListener('click', function() {
    console.log('Clicked!')
    document.querySelector('.pop-up').style.display = 'flex';
    });
    document.getElementById('closePopup').addEventListener('click', function() {
    document.querySelector('.pop-up').style.display = 'none';
    });
    function ConfirmSubmition(){
        var onConfirm = confirm('Are You Sure you Want to Delete this Tweet?')
        return onConfirm;
    }
</script>
</body>
